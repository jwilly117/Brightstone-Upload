<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Receipt Upload</title>
  <style>
    body { font-family: system-ui, Arial; margin: 0; background: #f6f7f9; }
    .wrap { max-width: 460px; margin: 0 auto; padding: 16px; }
    .card { background: #fff; border-radius: 14px; padding: 16px; box-shadow: 0 2px 12px rgba(0,0,0,.08); }
    h1 { font-size: 20px; margin: 0 0 10px; }
    label { display:block; font-size: 13px; margin: 12px 0 6px; color:#333; }
    input, textarea, button {
      width: 100%; box-sizing: border-box; padding: 12px; border-radius: 10px;
      border: 1px solid #d6d8dd; font-size: 16px; background: #fff;
    }
    textarea { min-height: 70px; }
    button { border: 0; padding: 14px; font-weight: 700; background: #111; color: #fff; }
    button:disabled { opacity:.6; }
    .hint { font-size: 12px; color:#666; margin-top: 8px; }
    .status { margin-top: 12px; font-size: 14px; }
    .status.ok { color: #0a7a2f; }
    .status.err { color: #b00020; }
    .preview { width:100%; border-radius: 10px; margin-top: 10px; display:none; border:1px solid #eee; }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <h1>Upload a Receipt</h1>

      <label>Receipt Photo</label>
      <input id="file" type="file" accept="image/*" capture="environment" />
      <img id="preview" class="preview" />

      <label>Amount (optional)</label>
      <input id="amount" inputmode="decimal" placeholder="12.34" />

      <label>Vendor (optional)</label>
      <input id="vendor" placeholder="Home Depot" />

      <label>Notes (optional)</label>
      <textarea id="notes" placeholder="Job name, who it’s for, etc."></textarea>

      <label>PIN</label>
      <input id="pin" type="password" inputmode="numeric" placeholder="••••" />

      <div style="height:12px"></div>
      <button id="btn">Upload</button>
      <div class="hint">Tip: Use the camera button to snap it right now.</div>

      <div id="status" class="status"></div>
    </div>
  </div>

<script>
  // TODO: Replace this with your deployed Firebase Function URL
  const API_URL = "https://YOUR_REGION-YOUR_PROJECT.cloudfunctions.net/uploadReceipt";

  const fileEl = document.getElementById("file");
  const previewEl = document.getElementById("preview");
  const statusEl = document.getElementById("status");
  const btn = document.getElementById("btn");

  fileEl.addEventListener("change", () => {
    const f = fileEl.files?.[0];
    if (!f) return;
    const url = URL.createObjectURL(f);
    previewEl.src = url;
    previewEl.style.display = "block";
  });

  function setStatus(msg, kind) {
    statusEl.textContent = msg;
    statusEl.className = "status " + (kind || "");
  }

  btn.addEventListener("click", async () => {
    setStatus("", "");
    const f = fileEl.files?.[0];
    const pin = document.getElementById("pin").value.trim();
    if (!f) return setStatus("Please pick a receipt photo.", "err");
    if (!pin) return setStatus("Enter the PIN.", "err");

    btn.disabled = true;
    btn.textContent = "Uploading...";

    try {
      const fd = new FormData();
      fd.append("file", f);
      fd.append("pin", pin);
      fd.append("amount", document.getElementById("amount").value.trim());
      fd.append("vendor", document.getElementById("vendor").value.trim());
      fd.append("notes", document.getElementById("notes").value.trim());
      fd.append("clientTime", new Date().toISOString());

      const res = await fetch(API_URL, { method: "POST", body: fd });
      const data = await res.json().catch(() => ({}));

      if (!res.ok || !data.ok) {
        throw new Error(data.error || `Upload failed (${res.status})`);
      }

      setStatus("Uploaded ✅ Thank you!", "ok");
      // reset
      fileEl.value = "";
      previewEl.style.display = "none";
      document.getElementById("amount").value = "";
      document.getElementById("vendor").value = "";
      document.getElementById("notes").value = "";
      document.getElementById("pin").value = "";
    } catch (e) {
      setStatus(e.message || "Upload failed.", "err");
    } finally {
      btn.disabled = false;
      btn.textContent = "Upload";
    }
  });
</script>
</body>
</html>
